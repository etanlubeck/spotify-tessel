{
  "name": "gprs-sim900",
  "description": "Driver for the gprs-sim900 Tessel GPRS/SIM module ([SIM900](ftp://imall.iteadstudio.com/IM120417009_IComSat/DOC_SIM900_Hardware%20Design_V2.00.pdf)).",
  "version": "0.1.4",
  "main": "index.js",
  "directories": {
    "example": "examples"
  },
  "hardware": {
    "./examples": false,
    "tape": false,
    "tap": false,
    "shelljs": false
  },
  "scripts": {
    "test": "tinytap -e 'tessel run {} ${GPRS_PORT}' test/*.js"
  },
  "author": {
    "name": "Eric Kolker"
  },
  "license": "MIT",
  "dependencies": {},
  "devDependencies": {
    "tinytap": "^0.2.0"
  },
  "readme": "#GPRS/SIM\nDriver for the gprs-sim900 Tessel GPRS/SIM module. The hardware documentation for this module can be found [here](https://github.com/tessel/hardware/blob/master/modules-overview.md#gprs).\n\nIf you run into any issues you can ask for support on the [GPRS Module Forums](http://forums.tessel.io/category/gprs).\n\n## Installation\n```sh\nnpm install gprs-sim900\n```\n\n###Configuring the GPRSModule\n*Note:* The GPRS module must be configured properly in hardware in order for it to work. At the very least, make sure your Tessel and GPRS module look like the ones in the image below (plus a SIM card in the holder on the module, not pictured below). For a full overview of the GPRS module hardware, see [this section](./README.md#hardware-overviewsetup).\n\n![GPRS module minimum configuration](https://s3.amazonaws.com/technicalmachine-assets/doc+pictures/gprs-hw-set.jpg)\n\n#### HW Configuration Checklist\n\n* GPRS power input select header (three-pin header in board corner) moved to '3.3V Tessel' (the two pins closest to board corner).\n* Antenna plugged in\n* SIM card in holder (not pictured above)\n\nIf the yellow `STATUS` light is on and the green `NETLIGHT` is blinking when the module is plugged in, then the module is configured correctly.\n\n###Purchasing a SIM Card\nFor the purposes of the GPRS module, you will probably want a very basic SIM card. So simple that it can often be hard to convince the staff at many service providers to give you a plan that is that basic. We have found that it helps if you are very insistent about what features you want. \nFor full text/call functionality with Tessel's GPRS module, you will want a sim card that\n* is mini-SIM sized \n* has just text and calling functionality\n* is pre-paid, not a monthly plan\n* is unlocked\n\nIf you are clear and firm about your requirements when buying in store, you should not have any problem. You can also order a SIM card online from many providers. As for providers, we have had good luck with both AT&T and T-Mobile.\n\n###A Note About SIM Cards\nSIM cards can only hold 20-30 SMS messages at a time, depending on the sim card you have. If your SIM stops emiting events as expected, you can use the command line and the AT command manual to manually delete messages you do not want to keep on the SIM, or you can use the remove option included in the readSMS function to automatically delete messages after you read or log the messages.\n\n###Example\n```js\n// Any copyright is dedicated to the Public Domain.\n// http://creativecommons.org/publicdomain/zero/1.0/\n\n/*********************************************\nUse the GPRS module to send a text to a phone\nnumber of your choice.\n*********************************************/\n\nvar tessel = require('tessel');\nvar hardware = tessel.port['A'];\nvar gprslib = require('gprs-sim900');\n\nvar phoneNumber = '##########'; // Replace the #s with the String representation of the phone number, including country code (1 for USA)\nvar message = 'Text from a Tessel!';\n\n//  Port, callback\nvar gprs = gprslib.use(hardware); \n\ngprs.on('ready', function() {\n  console.log('GPRS module connected to Tessel. Searching for network...')\n  //  Give it 10 more seconds to connect to the network, then try to send an SMS\n  setTimeout(function() {\n    console.log('Sending', message, 'to', phoneNumber, '...');\n    // Send message\n    gprs.sendSMS(phoneNumber, message, function smsCallback(err, data) {\n      if (err) {\n        return console.log(err);\n      }\n      var success = data[0] !== -1;\n      console.log('Text sent:', success);\n      if (success) {\n        // If successful, log the number of the sent text\n        console.log('GPRS Module sent text #', data[0]);\n      }\n    });\n  }, 10000);\n});\n\n//  Emit unsolicited messages beginning with...\ngprs.emitMe(['NORMAL POWER DOWN', 'RING', '+']);\n\ngprs.on('NORMAL POWER DOWN', function powerDaemon () {\n  gprs.emit('powered off');\n  console.log('The GPRS Module is off now.');\n});\n\ngprs.on('RING', function someoneCalledUs () {\n  var instructions = 'Someone\\'s calling!\\nType the command \\'ATA\\' to answer and \\'ATH\\' to hang up.\\nYou\\'ll need a mic and headset connected to talk and hear.\\nIf you want to call someone, type \\'ATD\"[their 10+digit number]\"\\'.';\n  console.log(instructions);\n});\n\ngprs.on('+', function handlePlus (data) {\n  console.log('Got an unsolicited message that begins with a \\'+\\'! Data:', data);\n});\n\n//  Command the GPRS module via the command line\nprocess.stdin.resume();\nprocess.stdin.on('data', function (data) {\n  data = String(data).replace(/[\\r\\n]*$/, '');  //  Removes the line endings\n  console.log('got command', [data]);\n  gprs._txrx(data, 10000, function(err, data) {\n    console.log('\\nreply:\\nerr:\\t', err, '\\ndata:');\n    data.forEach(function(d) {\n      console.log('\\t' + d);\n    });\n    console.log('');\n  });\n});\n\n//  Handle errors\ngprs.on('error', function (err) {\n  console.log('Got an error of some kind:\\n', err);\n});\n\n```\n\n###Methods\n\n&#x20;<a href=\"#api-gprs-answerCall-callback-err-data-Answer-an-incoming-voice-call\" name=\"api-gprs-answerCall-callback-err-data-Answer-an-incoming-voice-call\">#</a> gprs<b>.answerCall</b>( callback(err, data) )  \n Answer an incoming voice call.  \n\n&#x20;<a href=\"#api-gprs-_chain-messages-patiences-replies-callback-err-data-Send-a-series-of-back-to-back-messages-recursively-and-do-something-with-the-final-result-Other-results-if-not-of-the-form-messages-n-OK-error-out-and-pass-false-to-the-callback-The-arguments-messages-and-patience-must-be-of-the-same-length-Like-_txrx-this-function-is-also-useful-for-expanding-the-module-s-functionality\" name=\"api-gprs-_chain-messages-patiences-replies-callback-err-data-Send-a-series-of-back-to-back-messages-recursively-and-do-something-with-the-final-result-Other-results-if-not-of-the-form-messages-n-OK-error-out-and-pass-false-to-the-callback-The-arguments-messages-and-patience-must-be-of-the-same-length-Like-_txrx-this-function-is-also-useful-for-expanding-the-module-s-functionality\">#</a> gprs<b>._chain</b>( messages, patiences, replies, callback(err, data) )  \n Send a series of back-to-back messages recursively and do something with the final result. Other results, if not of the form [messages[n], 'OK'] error out and pass false to the callback. The arguments messages and patience must be of the same length. Like _txrx, this function is also useful for expanding the module's functionality.  \n\n&#x20;<a href=\"#api-gprs-dial-number-callback-err-data-Call-the-specified-number-voice-call-not-data-call\" name=\"api-gprs-dial-number-callback-err-data-Call-the-specified-number-voice-call-not-data-call\">#</a> gprs<b>.dial</b>( number, callback(err, data))  \nCall the specified number (voice call, not data call ).  \n\n&#x20;<a href=\"#api-gprs-hangUp-callback-err-data-Terminate-a-voice-call\" name=\"api-gprs-hangUp-callback-err-data-Terminate-a-voice-call\">#</a> gprs<b>.hangUp</b>( callback(err, data) )  \n Terminate a voice call.  \n\n&#x20;<a href=\"#api-gprs-_checkEmissions-Run-through-the-emissions-every-time-an-unsolicited-message-comes-in-and-emit-events-accordingly-This-function-is-key-to-the-emitMe-method-There-is-probably-a-better-way-to-do-this-so-consider-the-function-unstable-and-pull-requests-welcome\" name=\"api-gprs-_checkEmissions-Run-through-the-emissions-every-time-an-unsolicited-message-comes-in-and-emit-events-accordingly-This-function-is-key-to-the-emitMe-method-There-is-probably-a-better-way-to-do-this-so-consider-the-function-unstable-and-pull-requests-welcome\">#</a> gprs<b>._checkEmissions</b>()  \n Run through the emissions every time an unsolicited message comes in and emit events accordingly. This function is key to the emitMe method. There is probably a better way to do this, so consider the function unstable and pull requests welcome.  \n\n&#x20;<a href=\"#api-gprs-emitMe-beginnings-Many-unsolicited-events-are-very-useful-to-the-user-such-as-when-an-SMS-is-received-or-a-call-is-pending-Beginnings-is-an-array-of-strings-the-function-will-emit-unsolicited-messages-that-begin-with-these-strings-There-is-probably-a-better-way-to-do-this-so-consider-the-function-unstable-and-pull-requests-welcome\" name=\"api-gprs-emitMe-beginnings-Many-unsolicited-events-are-very-useful-to-the-user-such-as-when-an-SMS-is-received-or-a-call-is-pending-Beginnings-is-an-array-of-strings-the-function-will-emit-unsolicited-messages-that-begin-with-these-strings-There-is-probably-a-better-way-to-do-this-so-consider-the-function-unstable-and-pull-requests-welcome\">#</a> gprs<b>.emitMe</b>( beginnings )  \n Many unsolicited events are very useful to the user, such as when an SMS is received or a call is pending. Beginnings is an array of strings, the function will emit unsolicited messages that begin with these strings. There is probably a better way to do this, so consider the function unstable and pull requests welcome.  \n\n&#x20;<a href=\"#api-gprs-readSMS-index-mode-callback-err-message-Read-the-index-specified-SMS-Mode-can-be-zero-and-make-the-message-as-read-or-one-and-not-change-the-status-of-the-message-The-callback-s-message-is-an-array-where-index-0-command-echo-1-message-information-read-state-source-number-data-2-message-text\" name=\"api-gprs-readSMS-index-mode-callback-err-message-Read-the-index-specified-SMS-Mode-can-be-zero-and-make-the-message-as-read-or-one-and-not-change-the-status-of-the-message-The-callback-s-message-is-an-array-where-index-0-command-echo-1-message-information-read-state-source-number-data-2-message-text\">#</a> gprs<b>.readSMS</b>( index, mode, remove, callback(err, message) )   \nRead the index specified SMS. \n* Mode can be zero and make the message as read, or one and not change the status of the message. \n* Remove can be zero and keep the message on the sim card, or one and delete the message from the sim card. This is useful because sim cards can only hold around 20-30 messages at a time.\n* The callback's message is an array where index 0: command echo, 1: message information (read state, source number, data), 2: message text.\n\n&#x20;<a href=\"#api-gprs-sendSMS-number-message-callback-err-data-Send-an-SMS-to-the-specified-number\" name=\"api-gprs-sendSMS-number-message-callback-err-data-Send-an-SMS-to-the-specified-number\">#</a> gprs<b>.sendSMS</b>( number, message, callback(err, data) )  \n Send an SMS to the specified number.  \n\n&#x20;<a href=\"#api-gprs-togglePower-callback-Turn-the-module-on-or-off\" name=\"api-gprs-togglePower-callback-Turn-the-module-on-or-off\">#</a> gprs<b>.togglePower</b>( callback() )  \n Turn the module on or off.  \n\n###Events\n\n&#x20;<a href=\"#api-gprs-on-powerToggled-callback-The-SIM900-has-been-turned-on-or-off\" name=\"api-gprs-on-powerToggled-callback-The-SIM900-has-been-turned-on-or-off\">#</a> gprs<b>.on</b>( 'powerToggled', callback() )  \nThe SIM900 has been turned on or off  \n\n&#x20;<a href=\"#api-gprs-on-ready-callback-The-SIM900-is-ready-to-recieve-commands-Note-that-it-may-not-yet-be-connected-to-the-cell-network\" name=\"api-gprs-on-ready-callback-The-SIM900-is-ready-to-recieve-commands-Note-that-it-may-not-yet-be-connected-to-the-cell-network\">#</a> gprs<b>.on</b>( 'ready', callback() )  \n The SIM900 is ready to recieve commands. Note that it may not yet be connected to the cell network.  \n\n&#x20;<a href=\"#api-gprs-on-unsolicited-callback-data\" name=\"api-gprs-on-unsolicited-callback-data\">#</a> gprs<b>.on</b>( 'unsolicited', callback(data) )  \n Called when the SIM900 send an unsolicited packet to the Tessel. data is the contents of the message.\n\n&#x20;<a href=\"#api-gprs-on-_intermediate-callback-correct-Used-internally-for-_chain\" name=\"api-gprs-on-_intermediate-callback-correct-Used-internally-for-_chain\">#</a> gprs<b>.on</b>( '_intermediate', callback(correct) )  \n Used internally for _chain  \n\n###GPRS sim-900 AT Commands\n\nThe GPRS module follows the sim-900 AT command structure. The full documentation can be found here: [SIM-900 AT Command Manual](http://wm.sim.com/upfile/2013424141114f.pdf).\n\nYou can control the GPRS module from the command line using the `command-line.js` example in the `examples/` directory. For example, you can check if your Tessel is connected to a network by running `AT+CGATT?`. \n\n\nYou can enter these commands in your console if your Tessel is running a script that contains the following code.\n\n```js\n//  Command the GPRS module via the command line\nprocess.stdin.resume();\nprocess.stdin.on('data', function (data) {\n  data = String(data).replace(/[\\r\\n]*$/, '');  //  Removes the line endings\n  console.log('got command', [data]);\n  gprs._txrx(data, 10000, function(err, data) {\n    console.log('\\nreply:\\nerr:\\t', err, '\\ndata:');\n    data.forEach(function(d) {\n      console.log('\\t' + d);\n    });\n    console.log('');\n  });\n});\n```\n\n####Useful Commands\n* Retreive texts (SMS) by typing `AT+CMGR=<index of message>`\n* Delete texts by typing  `AT+CMGD=<index of message>`\n* Other commands can be found the the extensive command manual\n\n###Hardware overview/setup\nThe GPRS module requries some setup in hardware in order to function properly. The image below highlights portions of the module users may need to configure.\n\n![GPRS module with important parts highlighted](https://s3.amazonaws.com/technicalmachine-assets/doc+pictures/gprs.jpg)\n\nClockwise from the bottom left:\n\n####SIM Card holder (orange)\nPut a SIM card here if you want to make calls, send SMS, etc.. When correctly inserted, the notched corner of the card will be closest to the SIM900.\n\n####Power and Reset buttons (dark blue)\nThe power button, also connected to GPIO3, can be used to turn the module on and off by pressing and holding the button for approximately one second. The Reset button can be used to force the module to undergo a hard reset.\n\n####Expansion jumpers (light blue)\nThese three jumpers are what control whether or not the GPRS module uses both module ports. When the jumpers are connected (**not** as shown in the image), the module will use both ports.\n\nNote that the GPRS module library currently does not currently support using both ports, so it is safest to leave the jumpers open. When the jumpers are open, another module can be plugged into the female header on the top edge of the module.\n\nThe pinout for the jumpers is as follows (top to bottom):\n\n* **Ring indicator** - This signal is routed to GPIO3 on the second module port when connected. It is asserted low by the SIM900 module when a call comes in or when an SMS is recieved.\n\n* **Debug TX** - This UART port talks at 115200 baud and is used only to upgrade the firmware on the SIM900 module. We haven't ever used it and doubt anyone else will, but better to break it out and not need it than the alternative.\n\n* **Debug RX** - This UART port talks at 115200 baud and is used only to upgrade the firmware on the SIM900 module. We haven't ever used it and doubt anyone else will, but better to break it out and not need it than the alternative.\n\n####Antenna connector (yellow)\nThis is where the antenna (black rectangle with a black wire whip) connects to the module.\n\n####Input power select header (green)\nThis header controls which power source the GPRS module uses to power the SIM900 module. The module will not work unless the pins are bridged in one of two ways:\n\n* When the jumper (not pictured) is bridging the *top* two pins, the module uses Tessel's 3.3 V rail to power the SIM900.\n* When the jumper is positioned such that the *bottom* two pins are connected, the SIM900 is powered off external power and the regulator on the GPRS module itself, which is tuned to ~3.465 V. When available, external power should be used to power the module.\n\nIf the pins are not connected in either of those ways, the GPRS module will not turn on.\n\n####External power input pins/connector (pink)\nThis black pin header and beige connector are where external power is applied to the GPRS module.\n\n* The connectors' VIN and GND pins are tied together, so power need only be applied to one of the connectors.\n* The input circuitry is rated to a  maximum of 17 V, a minimum of ~3.6 V.\n* VIN (positive voltage) should be applied to the left pin of the black header or lower of the two pins on the gray connector. GND is the right pin on the black header and the upper pin of the  gray connector.\n\n####Speaker/headset and microphone connectors (purple)\n3.5 mm stereo jacks for audio in and out.\n\n###License\nMIT or Apache 2.0, at your option\n",
  "readmeFilename": "README.md",
  "_id": "gprs-sim900@0.1.4",
  "_from": "gprs-sim900@"
}
